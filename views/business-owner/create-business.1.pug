extends ../layout

block content
  include include/navbar.pug
  .content-wrapper
    .container-fluid
      // Breadcrumbs
      ol.breadcrumb(style='background-color: #DAE1E7')
        li.breadcrumb-item.active.h4 Create Business
      //- span.text-dark
      //-   - if (error){
      //-     div #{error} 
      //-   - }
      //- span#error
      //-   - if (error){
      //-     option(type='hidden') #{error} 
      //-   - } 
      
      //script(type='text/javascript', src='../../javascripts/validation.js')
      form.needs-validation(enctype="multipart/form-data", action='/business-owner/business/create-business', method='POST', novalidate='', style='color: black; margin-left: -12px;')
        .form-group
          .col-lg-4.col-md-4.col-sm-4.col-xs-4
            label(for='categories') Categories:
          .col-lg-6.col-md-6.col-sm-6.col-xs-6
            select#category.form-control.selectpicker(name="category" multiple='')
              each value in Categories
                option(value=value.id) #{value.name}
        .form-group
          .col-lg-4.col-md-4.col-sm-4.col-xs-4
            label(for='name') Business Name:
          .col-lg-6.col-md-6.col-sm-6.col-xs-6
            input#name.form-control(type='text', name='name', placeholder='Business Name' value=business_name required)
            //- .invalid-feedback
            //-   | Please enter your business name
        .form-group
          .col-lg-4.col-md-4.col-sm-4.col-xs-4
            label(for='email') Email:
          .col-lg-6.col-md-6.col-sm-6.col-xs-6
            input#email.form-control(type='email', name='email', placeholder='name@example.com' value=email required)
            //.invalid-feedback
              | Please enter a valid email
        .form-group
          .col-lg-4.col-md-4.col-sm-4.col-xs-4
            label(for='phone_number') Contact Number:
          .col-lg-6.col-md-6.col-sm-6.col-xs-6
            input#phone_number.form-control(type='text', name='phone_number', placeholder='081xxxx' value=phone_number required)
            //.invalid-feedback
              | Please enter a valid phone number
        .form-group
          .col-lg-4.col-md-4.col-sm-4.col-xs-4
            label(for='website') Website:
          .col-lg-6.col-md-6.col-sm-6.col-xs-6
            input#website.form-control(type='text', name='website', placeholder='http://www.example.com' required)
            //.invalid-feedback
              | Please enter your website
        .form-group
          .col-lg-4.col-md-4.col-sm-4.col-xs-4
            label(for='photo') Photo:
          .col-lg-6.col-md-6.col-sm-6.col-xs-6
            .custom-file
              //- input.custom-file-input(type='file' name="photo" id="photo")
              //- label.custom-file-label Choose file...
              input#photo.form-control(type='file' accept="image/*" name='photo')
        .form-group
          .col-lg-4.col-md-4.col-sm-4.col-xs-4
            label(for='description') Description:
          .col-lg-8.col-md-8.col-sm-8.col-xs-8
            textarea#description.form-control(name="description", rows="4") lorem ipsum dolor
        .form-group.col-lg-10.col-md-10.col-sm-10.col-xl-10
          label(for='address') Address:
          .card.mb-3
            .card-body
              .form-row
                .form-group.col-lg-12.col-md-12.col-sm-12.col-xl-12
                  input#pac-input.form-control(type='text', name='raw_address', placeholder='Enter an address' required)
                  .invalid-feedback
                    | Please enter your address
              #map
              #infowindow-content
                img#place-icon(src='', width='16', height='16')
                span#place-name.title
                br
                span#place-address
              script(src='/javascripts/maps-business.js')
              script(src='https://maps.googleapis.com/maps/api/js?key=AIzaSyBSKactSNtQkMmc86xP_oknMBCABF2ioYI&libraries=places&callback=initMap', async='', defer='')
              hr
              .form-row
                .form-group.col-lg-6.col-md-6.col-sm-6.col-xl-6
                  label Line 1:
                  input#line1.form-control(type='text', name='line1', placeholder='Line 1 Address' readonly)
                .form-group.col-lg-6.col-md-6.col-sm-6.col-xl-6
                  label Line 2:
                  input#line2.form-control(type='text', name='line2', placeholder='Line 2 Address' readonly)
              .form-row
                .form-group.col-lg-4.col-md-4.col-sm-4.col-xl-4
                  label Country:
                  input#country.form-control(type='text', name='country', placeholder='Country' readonly)
                .form-group.col-lg-4.col-md-4.col-sm-4.col-xl-4
                  label Administrative Area Level 1:
                  input#adm1.form-control(type='text', name='adm_area_lv1', placeholder='Administrative Area Level 1' readonly)
                .form-group.col-lg-4.col-md-4.col-sm-4.col-xl-4
                  label Administrative Area Level 2:
                  input#adm2.form-control(type='text', name='adm_area_lv2', placeholder='Administrative Area Level 2' readonly)
              .form-row
                .form-group.col-lg-4.col-md-4.col-sm-4.col-xl-4
                  label Administrative Area Level 3:
                  input#adm3.form-control(type='text', name='adm_area_lv3', placeholder='Administrative Area Level 3' readonly)
                .form-group.col-lg-4.col-md-4.col-sm-4.col-xl-4
                  label Administrative Area Level 4:
                  input#adm4.form-control(type='text', name='adm_area_lv4', placeholder='Administrative Area Level 4' readonly)
                .form-group.col-lg-4.col-md-4.col-sm-4.col-xl-4
                  label Postal Code:
                  input#postal_code.form-control(type='text', name='postal_code', placeholder='Postal Code' readonly)
              .form-row
                .form-group.col-lg-6.col-md-6.col-sm-6.col-xs-6
                  label Latitude:
                  input#lat.form-control(type='text', name='lat', placeholder='Latitude', readonly required)
                .form-group.col-lg-6.col-md-6.col-sm-6.col-xs-6
                  label Longitude:
                  input#lng.form-control(type='text', name='lng', placeholder='Longitude', readonly required)
              .form-row
                .form-group.col-lg-12.col-md-12.col-sm-12.col-xl-12
                  label Formatted Address:
                  input#formatted_address.form-control(type='text', name='formatted_address', placeholder='Enter an address' readonly required)
        input.btn.btn-md.color-ink.ml-3.mb-5(type='submit', value='Submit')
        input.btn.btn-md.color-ink.ml-2.mb-5(type='submit', value='Submit and Add Outlet >')
      span#error
        - if (error){
          option(type='hidden') #{error} 
        - } 
  include ../includes/logout.pug

  include ../includes/footer.pug
  
  script.
    $('.selectpicker').selectpicker({
      style: 'btn-select',
      size: 4
    });
    //bootstrapValidate('#category', 'required:Please select your business category.')
    bootstrapValidate('#name', 'min:3:Enter at least 3 characters!');
    bootstrapValidate('#name', 'required:Please enter your business name.')
    bootstrapValidate('#email', 'email:Please enter a valid email address.');
    bootstrapValidate('#email', 'required:Please enter your email address.')
    bootstrapValidate('#phone_number', 'numeric:Only enter numeric characters. | required:Please enter your contact number.')
    //bootstrapValidate('#phone_number', 'required:Please enter your contact number.')
    bootstrapValidate('#website', 'url:Please enter a valid website url.')
    bootstrapValidate('#name', 'required:Please enter your business name.')
    bootstrapValidate('#pac-input', 'required:Please enter your address')
    bootstrapValidate('#formatted_address', 'required:Please enter your address')

    function saveUser(){   
      $.ajax({
      url:"/api/user/"+<%=data[0].user_id%>,
      type:"put",
      data:$("#the-form").serialize(),
      success:function(res){
          
          window.location.href = '/api/user';
          return false;
      },
      error:function(xhr, status, error){
        console.log(xhr.responseText);
        var err = '';
        $.each(JSON.parse(xhr.responseText) , function(i, item) {
            
              err +='<li>'+item.msg+'</li>';
        });
        $(".err-area").html(err);    
        return false;
      }
      
      });
    }